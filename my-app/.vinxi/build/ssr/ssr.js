import{ssrElement as g,escape as m,mergeProps as x,ssr as d,renderToStream as A,getRequestEvent as M,createComponent as h,NoHydration as E,ssrHydrationKey as b,ssrAttribute as F}from"solid-js/web";import{lazy as H,createComponent as P,sharedConfig as $}from"solid-js";import{provideRequestEvent as I}from"solid-js/web/storage";import{getRequestURL as R,getRequestWebStream as N,getRequestIP as L,setResponseHeader as y,setResponseStatus as w,appendResponseHeader as O,getResponseHeader as _,removeResponseHeader as j,getCookie as B,setCookie as W,eventHandler as z,sendRedirect as J,setHeader as U}from"h3";function D(e){let t;const n=R(e),s={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(n,{...s,body:e.node.req.body}):new Request(n,{...s,get body(){return t||(t=N(e),t)}})}function K(e){return e.web??={request:D(e),url:R(e)},e.web.request}const T=Symbol("h3Event"),f=Symbol("fetchEvent"),Y={get(e,t){return t===f?e:e[t]??e[T][t]}};function G(e){return e.web||(e.web={url:R(e),request:K(e)}),new Proxy({request:e.web.request,clientAddress:L(e),locals:{},[T]:e},Y)}function Q(e){if(!e[f]){const t=G(e);e[f]=t}return e[f]}var V=" ";const X={style:e=>g("style",e.attrs,()=>m(e.children),!0),link:e=>g("link",e.attrs,void 0,!0),script:e=>e.attrs.src?g("script",x(()=>e.attrs,{get id(){return e.key}}),()=>d(V),!0):null};function k(e){let{tag:t,attrs:{key:n,...s}={key:void 0},children:r}=e;return X[t]({attrs:s,key:n,children:r})}function Z(e,t,n,s="default"){return H(async()=>{{const a=(await e.import())[s],i=(await t.inputs?.[e.src].assets()).filter(c=>c.tag==="style"||c.attrs.rel==="stylesheet");return{default:c=>[...i.map(u=>k(u)),P(a,c)]}}})}const v=[{type:"page",$component:{src:"src/routes/[...404].tsx?pick=default&pick=$css",build:()=>import("./_...404_.js"),import:()=>import("./_...404_.js")},path:"/*404",filePath:"/workspaces/diet_hack/my-app/src/routes/[...404].tsx"},{type:"page",$component:{src:"src/routes/about.tsx?pick=default&pick=$css",build:()=>import("./about.js"),import:()=>import("./about.js")},path:"/about",filePath:"/workspaces/diet_hack/my-app/src/routes/about.tsx"},{type:"page",$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("./index.js"),import:()=>import("./index.js")},path:"/",filePath:"/workspaces/diet_hack/my-app/src/routes/index.tsx"}],ee=se(v.filter(e=>e.type==="page")),te=re(v.filter(e=>e.type==="api"));function ne(e,t){const n=e.replace("","").split("/").filter(Boolean);e:for(const s of te){const r=s.matchSegments;if(n.length<r.length||!s.wildcard&&n.length>r.length)continue;for(let i=0;i<r.length;i++){const l=r[i];if(l&&n[i]!==l)continue e}const a=s[`$${t}`];if(a==="skip"||a===void 0)return;const o={};for(const{type:i,name:l,index:c}of s.params)i===":"?o[l]=n[c]:o[l]=n.slice(c).join("/");return{handler:a,params:o}}}function se(e){function t(n,s,r,a){const o=Object.values(n).find(i=>r.startsWith(i.id+"/"));return o?(t(o.children||(o.children=[]),s,r.slice(o.id.length)),n):(n.push({...s,id:r,path:r.replace(/\/\([^)/]+\)/g,"")}),n)}return e.sort((n,s)=>n.path.length-s.path.length).reduce((n,s)=>t(n,s,s.path,s.path),[])}function re(e){return e.flatMap(t=>C(t.path).map(s=>({...t,path:s}))).map(oe).sort((t,n)=>n.score-t.score)}function C(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),s=e.slice(t.index+t[0].length);const r=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(s);)r.push(n+=t[1]),s=s.slice(t[0].length);return C(s).reduce((a,o)=>[...a,...r.map(i=>i+o)],[])}function oe(e){const t=e.path.split("/").filter(Boolean),n=[],s=[];let r=0,a=!1;for(const[o,i]of t.entries())if(i[0]===":"){const l=i.slice(1);r+=3,n.push({type:":",name:l,index:o}),s.push(null)}else i[0]==="*"?(r-=1,n.push({type:"*",name:i.slice(1),index:o}),a=!0):(r+=4,i.match(/^\(.+\)$/)||s.push(i));return{...e,score:r,params:n,matchSegments:s,wildcard:a}}function ae(){function e(n){return{...n,...n.$$route?n.$$route.require().route:void 0,metadata:{...n.$$route?n.$$route.require().route.metadata:{},filesystem:!0},component:Z(n.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:n.children?n.children.map(e):void 0}}return ee.map(e)}function ie(e){const t=B(e,"flash");if(!t)return;let n=JSON.parse(t);if(!n||!n.result)return[];const s=[...n.input.slice(0,-1),new Map(n.input[n.input.length-1])];return W(e,"flash","",{maxAge:0}),{url:n.url,result:n.error?new Error(n.result):n.result,input:s}}async function le(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,y(e,"Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],initialSubmission:ie(e),routes:ae(),components:{status:s=>(w(e,s.code,s.text),()=>w(e,200)),header:s=>(s.append?O(e,s.name,s.value):y(e,s.name,s.value),()=>{const r=_(e,s.name);if(r&&typeof r=="string"){const a=r.split(", "),o=a.indexOf(s.value);o!==-1&&a.splice(o,1),a.length?y(e,s.name,a.join(", ")):j(e,s.name)}})},$islands:new Set})}function ce(e,t={}){return z({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:n=>{const s=Q(n);return I(s,async()=>{const r=ne(new URL(s.request.url).pathname,s.request.method);if(r){const p=(await r.handler.import())[s.request.method];return s.params=r.params,$.context={event:s},await p(s)}const a=await le(s);let o={...t};if(o.onCompleteAll){const u=o.onCompleteAll;o.onCompleteAll=p=>{q(a)(p),u(p)}}else o.onCompleteAll=q(a);if(o.onCompleteShell){const u=o.onCompleteShell;o.onCompleteShell=p=>{S(a,n)(),u(p)}}else o.onCompleteShell=S(a,n);const i=A(()=>($.context.event=a,e(a)),o);if(a.response&&a.response.headers.get("Location"))return J(s,a.response.headers.get("Location"));const{writable:l,readable:c}=new TransformStream;return i.pipeTo(l),c})}})}function S(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(w(t,302),U(t,"Location",e.response.headers.get("Location")))}}function q(e){return({write:t})=>{const n=e.response&&e.response.headers.get("Location");n&&t(`<script>window.location="${n}"<\/script>`)}}function ue(e,t){return ce(e,{...t,createPageEvent:pe})}async function pe(e){const t=globalThis.MANIFEST.client;return Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],routes:[],$islands:new Set})}var de=["<script",">","<\/script>"],me=["<script",' type="module"',"><\/script>"];const fe=d("<!DOCTYPE html>");function he(e){const t=M();return h(E,{get children(){return[fe,h(e.document,{get assets(){return t.assets.map(n=>k(n))},get scripts(){return[d(de,b(),`window.manifest = ${JSON.stringify(t.manifest)}`),d(me,b(),F("src",m(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]}})]}})}var ge=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],ye=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const Se=ue(()=>h(he,{document:({assets:e,children:t,scripts:n})=>d(ye,b(),h(E,{get children(){return d(ge,m(e))}}),m(t),m(n))}));export{Se as default};
